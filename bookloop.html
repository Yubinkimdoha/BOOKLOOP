<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BOOKLOOP ‚Äî S.K.V. VIVEK VIHAR</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
/* --- ROOT VARIABLES --- */
:root{
  --main: #003631;
  --main-light: #005C53;
  --side: #FFEDA8;
  --accent: #e77f24; /* Orange for Requests */
  --text-dark: #062723;
  --shadow: 0 10px 30px rgba(0,0,0,0.08);
  --glass: rgba(255, 255, 255, 0.15);
  /* New Condition Colors - using better names */
  --cond-new: #d4edda; --cond-new-text: #155724;
  --cond-good: #fff3cd; --cond-good-text: #856404;
  --cond-fair: #f8d7da; --cond-fair-text: #721c24; 
  --cond-worn: #f8d7da; --cond-worn-text: #721c24; 
}

/* --- BASE STYLES --- */
* { margin:0; padding:0; box-sizing:border-box; transition: all 0.2s ease; }

body{
  font-family: 'Poppins', sans-serif;
  background: radial-gradient(circle at top left, #dbece9, #fff);
  min-height: 100vh;
  display:flex; flex-direction: column; align-items: center;  
  padding: 40px 15px; color: var(--text-dark);
}

.container{
  width:100%; max-width:1000px;
  background: white; border-radius: 24px;
  box-shadow: var(--shadow); overflow: hidden; display: grid;
  grid-template-columns: 1.1fr 0.9fr;
}

/* --- LEFT PANEL (MAIN) --- */
.main{
  padding: 50px;
  background: linear-gradient(135deg, var(--main), #00211e);
  color: var(--side); display: flex; flex-direction: column; justify-content: center;
}
h1 { font-size: 48px; line-height: 1.1; margin: 10px 0; letter-spacing: -1px; }
#schoolName { opacity: 0.8; letter-spacing: 1px; text-transform: uppercase; font-size: 13px; font-weight: 600; }
.subtitle { font-size: 16px; opacity: 0.9; line-height: 1.6; margin-bottom: 30px; max-width: 90%; }

/* Buttons */
.btn { padding: 12px 24px; font-weight: 600; border-radius: 50px; border: none; cursor: pointer; font-size: 14px; display:inline-flex; align-items:center; gap:8px; transition: transform 0.2s ease, background 0.2s ease; }
.primary-btn { background: var(--side); color: var(--main); box-shadow: 0 4px 15px rgba(255, 237, 168, 0.3); }
.primary-btn:hover { transform: translateY(-2px); background: #fff; }
.ghost-btn { background: rgba(255,255,255,0.1); color: #fff; border: 1px solid rgba(255,255,255,0.3); }
.ghost-btn:hover { background: rgba(255,255,255,0.2); }

/* Glass Card */
.glass-card {
  margin-top: 40px; background: var(--glass);
  backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
  padding: 25px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1);
}
.glass-card ol { list-style: decimal inside; }
.glass-card li { margin-bottom: 8px; margin-left: 0; font-size: 14px; opacity: 0.9; }

/* --- RIGHT PANEL (SIDE) --- */
.side{ background: #F9FBF9; padding: 40px; display: flex; flex-direction: column; gap: 20px; }

.card{
  background: #fff; padding: 25px; border-radius: 16px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.03); border: 1px solid #eee;
}
.card h3 { color: var(--main); font-size: 18px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }

input, select{
  width: 100%; padding: 12px 15px; border-radius: 8px; border: 2px solid #eee;
  background: #fcfcfc; font-family: inherit; font-size: 14px; margin-bottom: 10px; outline: none; transition: border-color 0.2s ease, background 0.2s ease;
}
input:focus, select:focus { border-color: var(--main); background: #fff; }

/* Donation/Form Submit Button */
.submit-btn{ 
  width: 100%; padding: 12px; margin-top: 5px; border: none; border-radius: 8px; 
  font-weight: 600; cursor: pointer; display: flex; justify-content: center; 
  align-items: center; gap: 8px; transition: background 0.2s ease;
}
.submit-btn-primary { 
  background: var(--main); color: #fff; 
}
.submit-btn-primary:hover { background: var(--main-light); }
.submit-btn-accent { 
  background: var(--accent); color: #fff;
}
.submit-btn-accent:hover { background: #d3731f; }


/* --- LISTINGS & TABS AREA --- */
.listings-area { width: 100%; max-width: 1000px; margin-top: 30px; }

/* TABS */
.tab-container {
  display: flex; gap: 10px; margin-bottom: 20px;
  background: #eef2f2; padding: 5px; border-radius: 12px; width: fit-content;
}
.tab-btn {
  padding: 10px 20px; border: none; background: transparent;  
  border-radius: 8px; font-weight: 600; color: #666; cursor: pointer; transition: background 0.2s ease, box-shadow 0.2s ease, color 0.2s ease;
}
.tab-btn.active { background: white; color: var(--main); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

/* GRID */
.book-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; }

/* Book Item Base */
.book-item {
  background: white; padding: 18px; border-radius: 12px;  
  box-shadow: 0 4px 10px rgba(0,0,0,0.05); border: 1px solid #eee;
  display: flex; flex-direction: column; gap: 6px;  
  animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  position: relative;
}
@keyframes popIn { from{transform: scale(0.9); opacity:0;} to{transform: scale(1); opacity:1;} }

.book-top { display:flex; justify-content:space-between; align-items:start; margin-bottom:5px; }
.book-tag { font-size: 11px; font-weight: 700; text-transform: uppercase; background: #eef; color: var(--main); padding: 4px 8px; border-radius: 6px; }
.book-title { font-size:15px; color:var(--main); } 

/* Condition Badges */
.book-condition { font-size:12px; padding:2px 6px; border-radius:4px; width:fit-content; }
.cond-New { background: var(--cond-new); color: var(--cond-new-text); }
.cond-Good { background: var(--cond-good); color: var(--cond-good-text); }
.cond-Fair, .cond-Worn { background: var(--cond-worn); color: var(--cond-worn-text); } 

/* REQUEST ITEM STYLING */
.book-item.request-mode {
  border: 2px dashed #f0c49e;
  background: #fffaf5;
}
.book-item.request-mode .book-tag { background: #ffe8d6; color: var(--accent); }
.book-item.request-mode .book-title { color: var(--accent); } 

/* Action Button */
.action-btn {
  margin-top: 10px; padding: 8px; font-size: 12px; background: white;  
  border: 1px solid var(--main); color: var(--main); border-radius: 6px; cursor: pointer; font-weight:600; transition: background 0.2s ease, color 0.2s ease; 
}
.action-btn:hover { background: var(--main); color: #fff; }

/* Button style for responding to a request */
.give-btn { border-color: var(--accent); color: var(--accent); }
.give-btn:hover { background: var(--accent); color: #fff; }

/* --- TOAST NOTIFICATIONS --- */
#toast {
  visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center;
  border-radius: 50px; padding: 16px; position: fixed; z-index: 100; left: 50%; bottom: 30px;
  transform: translateX(-50%); font-size: 14px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}
#toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
@keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
@keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }

/* --- MODAL STYLES (for How it works) --- */
#howItWorksModal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: none; 
    justify-content: center; align-items: center;
    z-index: 200;
    backdrop-filter: blur(5px);
}
#howItWorksModal.show-modal {
    display: flex;
}
.modal-content {
    background: white; border-radius: 16px; padding: 30px;
    max-width: 500px; width: 90%;
    box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
    position: relative;
    animation: fadeInScale 0.3s ease-out;
}
@keyframes fadeInScale { from {opacity: 0; transform: scale(0.95);} to {opacity: 1; transform: scale(1);} }
.modal-close {
    position: absolute; top: 15px; right: 15px;
    font-size: 24px; font-weight: 300; line-height: 1;
    cursor: pointer; border: none; background: none;
    color: #999;
}
.modal-content h2 { color: var(--main); margin-bottom: 15px; font-size: 24px; }
.modal-content p { margin-bottom: 10px; font-size: 14px; line-height: 1.5; }
.modal-content ul { padding-left: 20px; margin-bottom: 20px; }
.modal-content li { font-size: 14px; margin-bottom: 5px; }

/* --- LANGUAGE ICON (NEW POSITION) --- */
#top-right-lang {
    position: absolute; /* Relative to the body or nearest positioned ancestor, but since body is centered, we use absolute positioning in the top right */
    top: 40px; /* Aligned with top padding of body */
    right: 20px; /* Space from the right edge */
    z-index: 50; /* Above the main container */
}

/* Language Icon Styling */
.lang-icon-container {
    position: relative;
    cursor: pointer;
    display: flex;
    align-items: center;
    padding: 10px; /* Add padding for click area */
    border-radius: 8px;
    background: white;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}
.lang-icon {
    font-size: 20px; 
    color: var(--main);
}
/* New Dropdown styles */
.lang-dropdown {
    position: absolute;
    top: 100%; 
    right: 0;
    background: white;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    min-width: 120px;
    overflow: hidden;
    margin-top: 5px;
    z-index: 10;
    display: none; 
}
.lang-dropdown.show {
    display: block;
}
.lang-dropdown a {
    display: block;
    padding: 10px 15px;
    text-decoration: none;
    color: var(--text-dark);
    font-size: 14px;
    font-weight: 500;
}
.lang-dropdown a:hover {
    background: #f0f0f0;
}
.lang-dropdown a.active-lang {
    background: var(--main-light);
    color: white;
    pointer-events: none; 
}

/* Hide the Language Status, as it's no longer a 'box' at the bottom */
#langStatus { display: none; } 

/* Media Query to adjust position on smaller screens */
@media (max-width: 768px) {
  .container { grid-template-columns: 1fr; }
  .main { padding: 40px 20px; text-align: center; }
  .glass-card li { text-align: left; } 
  .main > div:nth-child(4) { justify-content: center !important; } 

  #top-right-lang {
    top: 15px; /* Adjust closer to the edge */
    right: 15px; 
  }
}
</style>
</head>

<body>

<div id="top-right-lang">
    <div class="lang-icon-container" onclick="toggleLangDropdown(event)">
        <span class="lang-icon">üåê</span>
        <div id="langDropdown" class="lang-dropdown">
            <a href="#" data-lang="en">English</a>
            <a href="#" data-lang="hi">Hindi</a>
        </div>
    </div>
</div>
<div class="container">
  <main class="main">
    <div id="schoolName">S.K.V. VIVEK VIHAR</div>
    <h1 id="titleMain">BOOKLOOP</h1>
    <p class="subtitle" id="subtitle">Selling used books, find low-cost textbooks, and help classmates continue learning.</p>

    <div style="margin-top:10px; display:flex; gap:12px; justify-content: inherit;">
      <button class="btn primary-btn" onclick="switchTab('books')">Browse Books</button>
      <button class="btn ghost-btn" id="howItWorksBtn" onclick="showHowItWorksModal()">How it works</button>
    </div>

    <div class="glass-card">
      <h3 id="quickSteps">‚ö° Quick steps to help</h3>
      <ol style="opacity:0.95">
        <li id="step1">Choose classes (8th ‚Äî 12th)</li>
        <li id="step2">List the books and their condition</li>
        <li id="step3">Drop them at the school collection point</li>
      </ol>
    </div>
  </main>

  <aside class="side">
    <div class="card">
      <h3 id="bookDetails">üìï Sell a Book</h3>
      <input id="bookTitle" placeholder="Book title (e.g. Science NCERT)">
      <select id="bookCondition">
        <option value="New">Condition: New</option>
        <option value="Good">Condition: Good</option>
        <option value="Fair">Condition: Fair</option>
        <option value="Worn">Condition: Worn</option>
      </select>
      <select id="sellClass">
        <option value="12">Class 12</option><option value="11">Class 11</option><option value="10">Class 10</option><option value="9">Class 9</option><option value="8">Class 8</option>
      </select>
      <button class="submit-btn submit-btn-primary" onclick="submitDonation()" id="sellBtn">
        <span>Submit Selling</span> <span>‚ûî</span>
      </button>
    </div>

    <div class="card">
      <h3 id="buyTitle">üîç Find / Request</h3>
      
      <div style="display:flex; gap:10px;">
        <select id="buyClass" style="width:35%"><option value="">Class</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option></select>
        <input id="searchBook" placeholder="Search book name...">
      </div>
      <button class="submit-btn submit-btn-primary" onclick="searchBook()" id="searchBtn">Search</button>

      <div style="margin-top:25px; padding-top:20px; border-top:1px dashed #ddd;">
        <h4 id="reqLabel" style="color:var(--accent); font-size:13px; text-transform:uppercase; font-weight:bold; margin-bottom:10px;">Can't find it? Request it.</h4>
        <div style="display:flex; gap:10px;">
          <select id="requestClass" style="width:35%"><option value="">Class</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option></select>
          <input id="requestBook" placeholder="Book needed">
        </div>
        <button class="submit-btn submit-btn-accent" onclick="requestBookFn()" id="reqBtn">
          <span>Post Request</span> <span>‚ûî</span>
        </button>
      </div>
    </div>
  </aside>
</div>

<div class="listings-area">
  
  <div class="tab-container">
    <button class="tab-btn active" id="tabBooks" onclick="switchTab('books')">üìö Books Available</button>
    <button class="tab-btn" id="tabReq" onclick="switchTab('requests')">üôã Books Wanted</button>
  </div>

  <div class="book-grid" id="liveFeed">
  </div>
</div>

<p id="langStatus" style="padding-top:10px; color:#999; font-size:12px;">Current: English</p>
<div id="toast">Notification Message</div>

<div id="howItWorksModal" onclick="closeHowItWorksModal(event)">
    <div class="modal-content">
        <button class="modal-close" onclick="closeHowItWorksModal()">‚úñ</button>
        <h2 id="modalTitle">How BOOKLOOP Works</h2>
        <p>BookLoop helps students share and find used textbooks easily within the school community.</p>

        <h3 style="color:var(--main); margin-top:15px; font-size:16px;">üìö For Sellers/Donors:</h3>
        <ul id="sellerSteps">
            <li>**List It:** Use the "Sell a Book" section to list your textbook (Title, Class, Condition).</li>
            <li>**Wait for Contact:** Interested students will request the book via the app. You will receive a notification.</li>
            <li>**Drop Off:** Once a match is made, drop the book at the designated school collection point (e.g., Library).</li>
        </ul>

        <h3 style="color:var(--main); font-size:16px;">üîç For Buyers:</h3>
        <ul id="buyerSteps">
            <li>**Browse/Search:** Check the "Books Available" tab and use the search bar to find books.</li>
            <li>**Request:** If available, click "Request / Contact" to notify the seller.</li>
            <li>**Post a Request:** If you can't find a book, post a request in the "Books Wanted" tab.</li>
        </ul>
        <p style="margin-top:20px;">All transactions and handovers happen securely through the school's **BookLoop Coordinator**.</p>
    </div>
</div>


<script>
// --- 1. DATABASES ---
const booksDB = [
  { id: 1, title: "Flamingo (English Core)", class: "12", cond: "New", date: "Just now" },
  { id: 2, title: "Physics Part-I NCERT", class: "12", cond: "Good", date: "1 hr ago" },
  { id: 3, title: "Science Class X", class: "10", cond: "Worn", date: "2 days ago" },
  { id: 4, title: "Beehive (English)", class: "9", cond: "Good", date: "3 days ago" },
];

const requestsDB = [
  { id: 101, title: "Mathematics R.D. Sharma", class: "10", date: "Urgent" },
  { id: 102, title: "Chemistry Part-II", class: "12", date: "Today" },
  { id: 103, title: "Sanskrit Ruchira", class: "8", date: "Yesterday" }
];

let currentTab = 'books'; 
let currentLang = 'en'; // Track current language

// --- TRANSLATION MAPS ---
const translations = {
    en: {
        title: "BOOKLOOP", subtitle: "Selling used books, find low-cost textbooks, and help classmates continue learning.",
        browse: "Browse Books", howitworks: "How it works",
        quickSteps: "‚ö° Quick steps to help", step1: "Choose classes (8th ‚Äî 12th)", step2: "List the books and their condition",
        step3: "Drop them at the school collection point", sellBook: "üìï Sell a Book",
        sellTitle: "Book title (e.g. Science NCERT)", condNew: "Condition: New", condGood: "Condition: Good",
        condFair: "Condition: Fair", condWorn: "Condition: Worn", submitSell: "Submit Selling ‚ûî",
        findRequest: "üîç Find / Request", searchPlaceholder: "Search book name...", searchBtn: "Search",
        reqLabel: "Can't find it? Request it.", reqPlaceholder: "Book needed", postReq: "Post Request ‚ûî",
        tabAvailable: "üìö Books Available", tabWanted: "üôã Books Wanted", langStatus: "Current: English",
        classDefault: "Class",
        // Toasts
        toastTitle: "‚ö†Ô∏è Enter title!", toastFields: "‚ö†Ô∏è Fill all fields.",
        toastReqSent: "Request sent to owner!", toastHaveThis: "Thanks! Connecting you...",
        toastSearching: "üîç Searching...",
        // Modal Text
        modalTitle: "How BOOKLOOP Works", 
        sellerTitle: "üìö For Sellers/Donors:", 
        buyerTitle: "üîç For Buyers:",
        sellerSteps: [
            "**List It:** Use the \"Sell a Book\" section to list your textbook (Title, Class, Condition).",
            "**Wait for Contact:** Interested students will request the book via the app. You will receive a notification.",
            "**Drop Off:** Once a match is made, drop the book at the designated school collection point (e.g., Library)."
        ],
        buyerSteps: [
            "**Browse/Search:** Check the \"Books Available\" tab and use the search bar to find books.",
            "**Request:** If available, click \"Request / Contact\" to notify the seller.",
            "**Post a Request:** If you can't find a book, post a request in the \"Books Wanted\" tab."
        ],
        modalFooter: "All transactions and handovers happen securely through the school's **BookLoop Coordinator**."
    },
    hi: {
        title: "‡§¨‡•Å‡§ï‡§≤‡•Ç‡§™", subtitle: "‡§™‡•Å‡§∞‡§æ‡§®‡•Ä ‡§ï‡§ø‡§§‡§æ‡§¨‡•á‡§Ç ‡§¨‡•á‡§ö‡•á‡§Ç, ‡§ï‡§Æ ‡§ï‡•Ä‡§Æ‡§§ ‡§Æ‡•á‡§Ç ‡§™‡§æ‡§†‡•ç‡§Ø‡§™‡•Å‡§∏‡•ç‡§§‡§ï‡•á‡§Ç ‡§™‡§æ‡§è‡§Ç ‡§î‡§∞ ‡§∏‡§π‡§™‡§æ‡§†‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡•á‡§Ç‡•§",
        browse: "‡§ï‡§ø‡§§‡§æ‡§¨‡•á‡§Ç ‡§¶‡•á‡§ñ‡•á‡§Ç", howitworks: "‡§Ø‡§π ‡§ï‡•à‡§∏‡•á ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à",
        quickSteps: "‚ö° ‡§§‡•ç‡§µ‡§∞‡§ø‡§§ ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ö‡§∞‡§£", step1: "‡§ï‡§ï‡•ç‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç (8‡§µ‡•Ä‡§Ç ‚Äî 12‡§µ‡•Ä‡§Ç)", step2: "‡§ï‡§ø‡§§‡§æ‡§¨‡•á‡§Ç ‡§î‡§∞ ‡§â‡§®‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§∏‡•Ç‡§ö‡•Ä‡§¨‡§¶‡•ç‡§ß ‡§ï‡§∞‡•á‡§Ç",
        step3: "‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§∏‡•ç‡§ï‡•Ç‡§≤ ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π ‡§¨‡§ø‡§Ç‡§¶‡•Å ‡§™‡§∞ ‡§ú‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç", sellBook: "üìï ‡§è‡§ï ‡§ï‡§ø‡§§‡§æ‡§¨ ‡§¨‡•á‡§ö‡•á‡§Ç",
        sellTitle: "‡§ï‡§ø‡§§‡§æ‡§¨ ‡§ï‡§æ ‡§®‡§æ‡§Æ (‡§â‡§¶‡§æ. ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§® NCERT)", condNew: "‡§∏‡•ç‡§•‡§ø‡§§‡§ø: ‡§®‡§à", condGood: "‡§∏‡•ç‡§•‡§ø‡§§‡§ø: ‡§Ö‡§ö‡•ç‡§õ‡•Ä",
        condFair: "‡§∏‡•ç‡§•‡§ø‡§§‡§ø: ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø", condWorn: "‡§∏‡•ç‡§•‡§ø‡§§‡§ø: ‡§™‡•Å‡§∞‡§æ‡§®‡•Ä", submitSell: "‡§¨‡•á‡§ö‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç ‚ûî",
        findRequest: "üîç ‡§ñ‡•ã‡§ú‡•á‡§Ç / ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§ï‡§∞‡•á‡§Ç", searchPlaceholder: "‡§ï‡§ø‡§§‡§æ‡§¨ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§ñ‡•ã‡§ú‡•á‡§Ç...", searchBtn: "‡§ñ‡•ã‡§ú‡•á‡§Ç",
        reqLabel: "‡§ï‡§ø‡§§‡§æ‡§¨ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä? ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§ï‡§∞‡•á‡§Ç‡•§", reqPlaceholder: "‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§ï‡§ø‡§§‡§æ‡§¨", postReq: "‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç ‚ûî",
        tabAvailable: "üìö ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§ï‡§ø‡§§‡§æ‡§¨‡•á‡§Ç", tabWanted: "üôã ‡§Æ‡§æ‡§Ç‡§ó‡•Ä ‡§ó‡§à ‡§ï‡§ø‡§§‡§æ‡§¨‡•á‡§Ç", langStatus: "Current: Hindi",
        classDefault: "‡§ï‡§ï‡•ç‡§∑‡§æ",
        // Toasts
        toastTitle: "‚ö†Ô∏è ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç!", toastFields: "‚ö†Ô∏è ‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡•á‡§Ç‡•§",
        toastReqSent: "‡§Æ‡§æ‡§≤‡§ø‡§ï ‡§ï‡•ã ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§≠‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ!", toastHaveThis: "‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! ‡§Ü‡§™‡§ï‡•ã ‡§ú‡•ã‡§°‡§º‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...",
        toastSearching: "üîç ‡§ñ‡•ã‡§ú‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...",
        // Modal Text
        modalTitle: "‡§¨‡•Å‡§ï‡§≤‡•Ç‡§™ ‡§ï‡•à‡§∏‡•á ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à",
        sellerTitle: "üìö ‡§µ‡§ø‡§ï‡•ç‡§∞‡•á‡§§‡§æ‡§ì‡§Ç/‡§¶‡§æ‡§®‡§ï‡§∞‡•ç‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è:",
        buyerTitle: "üîç ‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è:",
        sellerSteps: [
            "**‡§∏‡•Ç‡§ö‡•Ä‡§¨‡§¶‡•ç‡§ß ‡§ï‡§∞‡•á‡§Ç:** ‡§Ö‡§™‡§®‡•Ä ‡§™‡§æ‡§†‡•ç‡§Ø‡§™‡•Å‡§∏‡•ç‡§§‡§ï (‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï, ‡§ï‡§ï‡•ç‡§∑‡§æ, ‡§∏‡•ç‡§•‡§ø‡§§‡§ø) ‡§ï‡•ã ‡§∏‡•Ç‡§ö‡•Ä‡§¨‡§¶‡•ç‡§ß ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è \"‡§è‡§ï ‡§ï‡§ø‡§§‡§æ‡§¨ ‡§¨‡•á‡§ö‡•á‡§Ç\" ‡§Ö‡§®‡•Å‡§≠‡§æ‡§ó ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§",
            "**‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡•á‡§Ç:** ‡§á‡§ö‡•ç‡§õ‡•Å‡§ï ‡§õ‡§æ‡§§‡•ç‡§∞ ‡§ê‡§™ ‡§ï‡•á ‡§Æ‡§æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡•á ‡§ï‡§ø‡§§‡§æ‡§¨ ‡§ï‡§æ ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§ï‡§∞‡•á‡§Ç‡§ó‡•á‡•§ ‡§Ü‡§™‡§ï‡•ã ‡§è‡§ï ‡§∏‡•Ç‡§ö‡§®‡§æ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§π‡•ã‡§ó‡•Ä‡•§",
            "**‡§ú‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç:** ‡§è‡§ï ‡§¨‡§æ‡§∞ ‡§Æ‡•à‡§ö ‡§π‡•ã ‡§ú‡§æ‡§®‡•á ‡§™‡§∞, ‡§ï‡§ø‡§§‡§æ‡§¨ ‡§ï‡•ã ‡§∏‡•ç‡§ï‡•Ç‡§≤ ‡§ï‡•á ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π ‡§¨‡§ø‡§Ç‡§¶‡•Å (‡§ú‡•à‡§∏‡•á ‡§™‡•Å‡§∏‡•ç‡§§‡§ï‡§æ‡§≤‡§Ø) ‡§™‡§∞ ‡§ú‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç‡•§"
        ],
        buyerSteps: [
            "**‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º/‡§ñ‡•ã‡§ú‡•á‡§Ç:** \"‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§ï‡§ø‡§§‡§æ‡§¨‡•á‡§Ç\" ‡§ü‡•à‡§¨ ‡§¶‡•á‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§ï‡§ø‡§§‡§æ‡§¨‡•á‡§Ç ‡§ñ‡•ã‡§ú‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ñ‡•ã‡§ú ‡§¨‡§æ‡§∞ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§",
            "**‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§ï‡§∞‡•á‡§Ç:** ‡§Ø‡§¶‡§ø ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§π‡•ã, ‡§§‡•ã ‡§µ‡§ø‡§ï‡•ç‡§∞‡•á‡§§‡§æ ‡§ï‡•ã ‡§∏‡•Ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è \"‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß/‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§",
            "**Post an Request:** ‡§Ø‡§¶‡§ø ‡§Ü‡§™‡§ï‡•ã ‡§ï‡•ã‡§à ‡§ï‡§ø‡§§‡§æ‡§¨ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤ ‡§∞‡§π‡•Ä ‡§π‡•à, ‡§§‡•ã \"‡§Æ‡§æ‡§Ç‡§ó‡•Ä ‡§ó‡§à ‡§ï‡§ø‡§§‡§æ‡§¨‡•á‡§Ç\" ‡§ü‡•à‡§¨ ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§™‡•ã‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§"
        ],
        modalFooter: "All transactions and handovers happen securely through the school's **BookLoop Coordinator**."
    }
};

// Initialize
window.onload = () => {
    // Attach event listeners to language links
    document.querySelectorAll('#langDropdown a').forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            changeLang(e.target.dataset.lang);
            document.getElementById('langDropdown').classList.remove('show'); // Close dropdown after selection
        });
    });
    
    // Initial language setup (defaults to 'en')
    changeLang(currentLang); 
};

// --- 2. SWITCH TABS ---
function switchTab(tab) {
  currentTab = tab;
  
  document.getElementById('tabBooks').className = tab === 'books' ? 'tab-btn active' : 'tab-btn';
  document.getElementById('tabReq').className = tab === 'requests' ? 'tab-btn active' : 'tab-btn';

  renderFeed();
}

// --- 3. RENDER FUNCTION (Unchanged) ---
function renderFeed(filterList = null) {
  const feed = document.getElementById('liveFeed');
  feed.innerHTML = "";
  
  let data = filterList || (currentTab === 'books' ? booksDB : requestsDB);
  const t = translations[currentLang];

  if(data.length === 0) {
    feed.innerHTML = `<p style="grid-column:1/-1; text-align:center; color:#999; padding:20px;">Empty List</p>`;
    return;
  }

  data.forEach(item => {
    if(currentTab === 'books') {
      feed.innerHTML += `
        <div class="book-item">
          <div class="book-top">
            <div class="book-tag">${t.classDefault} ${item.class}</div>
            <small style="color:#999; font-size:11px;">${item.date}</small>
          </div>
          <strong class="book-title">${item.title}</strong>
          <span class="book-condition cond-${item.cond}">${item.cond}</span>
          <button class="action-btn" onclick="showToast('${t.toastReqSent}')">Request / Contact</button>
        </div>`;
    } else {
      feed.innerHTML += `
        <div class="book-item request-mode">
          <div class="book-top">
            <div class="book-tag">${t.classDefault} ${item.class}</div>
            <small style="color:#c47c48; font-size:11px;">${item.date}</small>
          </div>
          <strong class="book-title">${item.title}</strong>
          <span style="font-size:12px; color:#c47c48;">User needs this</span>
          <button class="action-btn give-btn" onclick="showToast('${t.toastHaveThis}')">üôå I Have This!</button>
        </div>`;
    }
  });
}

// --- 4. ACTIONS (Unchanged) ---

function submitDonation(){
  const t = document.getElementById('bookTitle').value.trim();
  const c = document.getElementById('bookCondition').value;
  const cl = document.getElementById('sellClass').value;
  const trans = translations[currentLang];
  
  if(!t || !c || !cl) return showToast(trans.toastFields, "#d9534f");

  booksDB.unshift({ id: Date.now(), title: t, class: cl, cond: c, date: "Just now" });
  showToast(`‚úÖ Listed: ${t}`, "#003631");
  document.getElementById('bookTitle').value = "";
  
  switchTab('books'); 
}

function requestBookFn(){
  const cl = document.getElementById('requestClass').value;
  const t = document.getElementById('requestBook').value.trim();
  const trans = translations[currentLang];

  if(!cl || !t) return showToast(trans.toastFields, "#d9534f");

  requestsDB.unshift({ id: Date.now(), title: t, class: cl, date: "Just Now" });
  showToast(`üôã Request Posted: ${t}`, "#e77f24");
  document.getElementById('requestBook').value = "";
  
  switchTab('requests'); 
}

function searchBook(){
  const cls = document.getElementById('buyClass').value;
  const term = document.getElementById('searchBook').value.trim().toLowerCase();
  const trans = translations[currentLang];
  
  showToast(trans.toastSearching);

  const db = currentTab === 'books' ? booksDB : requestsDB;
  
  const results = db.filter(item => {
    const matchClass = cls ? item.class === cls : true;
    const matchName = term ? item.title.toLowerCase().includes(term) : true; 
    return matchClass && matchName;
  });

  renderFeed(results);
}

// --- 5. TRANSLATOR (Modified to remove langHeading) ---
function changeLang(lang) {
  currentLang = lang;
  const t = translations[currentLang];

  // 1. Hero Section
  document.getElementById("titleMain").innerText = t.title;
  document.getElementById("subtitle").innerText = t.subtitle;
  
  document.querySelector(".primary-btn").innerText = t.browse;
  document.getElementById("howItWorksBtn").innerText = t.howitworks;
  
  document.getElementById("quickSteps").innerText = t.quickSteps;
  document.getElementById("step1").innerText = t.step1;
  document.getElementById("step2").innerText = t.step2;
  document.getElementById("step3").innerText = t.step3;

  // 2. Sell Form
  document.getElementById("bookDetails").innerText = t.sellBook;
  document.getElementById("bookTitle").placeholder = t.sellTitle;
  document.getElementById("sellBtn").innerHTML = `<span>${t.submitSell.split(' ‚ûî')[0]}</span> <span>‚ûî</span>`; 
  
  document.querySelector('#bookCondition option[value="New"]').innerText = t.condNew;
  document.querySelector('#bookCondition option[value="Good"]').innerText = t.condGood;
  document.querySelector('#bookCondition option[value="Fair"]').innerText = t.condFair;
  document.querySelector('#bookCondition option[value="Worn"]').innerText = t.condWorn;
  
  // 3. Find/Request Form
  document.getElementById("buyTitle").innerText = t.findRequest;
  document.getElementById("searchBook").placeholder = t.searchPlaceholder;
  document.getElementById("searchBtn").innerText = t.searchBtn;
  document.getElementById("reqLabel").innerText = t.reqLabel;
  document.getElementById("requestBook").placeholder = t.reqPlaceholder;
  document.getElementById("reqBtn").innerHTML = `<span>${t.postReq.split(' ‚ûî')[0]}</span> <span>‚ûî</span>`;

  // 4. Listing Tabs
  document.getElementById("tabBooks").innerText = t.tabAvailable;
  document.getElementById("tabReq").innerText = t.tabWanted;

  // 5. Language Status (Hidden, but updated for completeness)
  document.getElementById("langStatus").innerText = t.langStatus;

  // 6. Update Class Dropdown defaults
  document.getElementById("buyClass").querySelector('option[value=""]').innerText = t.classDefault;
  document.getElementById("requestClass").querySelector('option[value=""]').innerText = t.classDefault;
  
  // 7. Modal Content Translation
  document.getElementById("modalTitle").innerText = t.modalTitle;
  document.getElementById("sellerSteps").previousElementSibling.innerText = t.sellerTitle;
  document.getElementById("buyerSteps").previousElementSibling.innerText = t.buyerTitle;
  document.getElementById("sellerSteps").innerHTML = t.sellerSteps.map(step => `<li>${step}</li>`).join('');
  document.getElementById("buyerSteps").innerHTML = t.buyerSteps.map(step => `<li>${step}</li>`).join('');
  document.getElementById("buyerSteps").nextElementSibling.innerHTML = t.modalFooter;

  // 8. Update Active Link in Dropdown
  document.querySelectorAll('#langDropdown a').forEach(link => {
      link.classList.remove('active-lang');
      if (link.dataset.lang === currentLang) {
          link.classList.add('active-lang');
      }
  });

  renderFeed();
}

// --- 6. MODAL FUNCTIONS (Unchanged) ---

function showHowItWorksModal() {
    document.getElementById('howItWorksModal').classList.add('show-modal');
}

function closeHowItWorksModal(event) {
    if (event && event.target.id !== 'howItWorksModal' && !event.target.classList.contains('modal-close')) {
        return; 
    }
    document.getElementById('howItWorksModal').classList.remove('show-modal');
}

// --- 7. LANGUAGE DROPDOWN TOGGLE (Unchanged) ---
function toggleLangDropdown(event) {
    event.stopPropagation(); 
    document.getElementById('langDropdown').classList.toggle('show');
}

// Close the dropdown if the user clicks anywhere else on the screen
document.addEventListener('click', function(event) {
    const dropdown = document.getElementById('langDropdown');
    // Check if the click occurred outside the dropdown and outside the icon container
    if (dropdown.classList.contains('show') && !dropdown.contains(event.target) && !event.target.closest('.lang-icon-container')) {
        dropdown.classList.remove('show');
    }
});


// --- UTILS ---
function showToast(message, color = "#333") {
  const x = document.getElementById("toast");
  x.innerText = message;
  x.style.background = color;
  x.className = "show";
  setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
}
</script>
</body>
</html>
